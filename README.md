# LED Lamp
###### *Utilized TI's Tiva C Serices MCU (ARM Cortex-M4F) to control an LED Lamp that used a I2C lux sensor to auto adjust the brightness. Almost all the code was developed from stratch to learn as much as possible programming on embedded sytems.*

## Project Description
A while back, I bought a cheap LED lamp off Amazon. Unlike most lamps that only output one color temperature, this lamp consisted of two LED groups, one LED group that emitted a warm light and another LED group that emitted a cool light. By adjusting the relative brightness of each LED, different temperature profiles could be made. The LED lamp had four built-in temperature profiles that the user could switch between. 

I wanted to know how the lamp operated so I hacked it apart, used an oscilloscope to probe a few signals and discovered that an onboard microcontroller was providing a PWM signal with variable duty cycles to set each different temperature profile. I thought that this would be a perfect opportunity to learn how to use my own microcontroller to control the brightness of the LEDs.

Originally, I developed of the code on the chipKit uC32 MCU (Microchip's version of the Arduino) but I soon got my hands on a Tiva C series MCU by Texas Instruments and ported the project over.

This LED lamp project incorporates several new features that the original product did not have. First, the LEDs do not change brightness instantly. Instead they brightness is changed in a gradual fashion using timers to create a smooth fading in/out effect. Second, the LED lamp could be controlled by a PC via UART. The command facade was used to create a module that received commands from the PC and executed the corresponding command such as setting a specific brightness or the amount of time it took for the LED to fade to a new temperature profile. Third, the brightness of the LEDs can be automatically set by an external I2C lux sensor. To support this sensor a robust I2C driver was developed that allowed the system to detect a I2C failure and continue to function properly without the lux sensor.

The source code utilizes TI's peripheral driver library which provides a very thin layer of abstraction between the user and direct register read/writes. In order to use the library effectively, the user still needs to properly understand how the specific MCU operates by reading the datasheet. This project could have been written without the use of TI's peripheral driver, but this was avoided for a couple of reasons. First, the functions provided by the peripheral driver makes it obvious to the reader of the code as to what registers the function is accessing. Usually when writing directly to the register, it is not so obvious and additional comments are needed to support each code statement. Second, it saves valuable time. There is no need to look up what each bit in each register does in the datasheet. This detail is encapsulated by library. 

Although this project seems relatively simple, a lot of important embedded systems concepts were learned through the development process. During this project, the book *Making Embedded Systems* by Elecia White was used as a complementary learning aid and several key concepts from the book were incorporated into the project. For instance, a better understanding of how to effectively use interrupts was gained and the command and facade design patterns were implemented.
